<!DOCTYPE html>
<head> 
<meta charset='utf-8'> 
<title>Relational basics</title> 
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script>
<![endif]--> 
<!--
<base href="file:///home/blambeau/work/devel/alf/doc/deploy-gh-pages/index.html" />
-->
<base href="http://blambeau.github.com/alf/index.html" />
<link rel="stylesheet" href="http://yandex.st/highlightjs/6.0/styles/github.min.css">
<link href="css/style.css" rel='stylesheet'>
<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="http://yandex.st/highlightjs/6.0/highlight.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    hljs.initHighlightingOnLoad();
  });
</script>
</head>
<body>
<a href="http://github.com/blambeau/alf"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">
  var current = "overview";
  function open(entry) {
    hide(current);
    current = entry;
    show(current);
  };
  function show(entry) {
    $('#menu-' + entry + " .content").slideDown(function(){
      window.location = entry + "/index.html";
    });
  };
  function hide(entry) {
    $('#menu-' + entry + " .content").slideUp();
  };
</script>

<div id="menu">

<div class="menu-entry" id="menu-overview">
<div class="head"><a href="javascript:open('overview');">Overview</a></div>
<div class="content" ><ul>
<li><a href="overview/index.html">Home</a></li>
<li><a href="overview/why.html">Why Alf ?</a></li>
<li><a href="overview/relational-basics.html">Relational basics</a></li>
<li><a href="overview/one-proposal-three-flavors.html">One proposal, three flavors</a></li>
<li><a href="overview/further-reading.html">Further reading</a></li>
</ul>

</div>
</div>

<div class="menu-entry" id="menu-shell">
<div class="head"><a href="javascript:open('shell');">Alf in Shell</a></div>
<div class="content" style="display:none;"><div class="subentry">Relational operators</div>
<p class="ops"><a href="shell/extend.html">extend</a>, <a href="shell/group.html">group</a>, <a href="shell/intersect.html">intersect</a>, <a href="shell/join.html">join</a>, <a href="shell/matching.html">matching</a>, <a href="shell/minus.html">minus</a>, <a href="shell/not-matching.html">not-matching</a>, <a href="shell/project.html">project</a>, <a href="shell/rank.html">rank</a>, <a href="shell/rename.html">rename</a>, <a href="shell/restrict.html">restrict</a>, <a href="shell/summarize.html">summarize</a>, <a href="shell/ungroup.html">ungroup</a>, <a href="shell/union.html">union</a>, <a href="shell/unwrap.html">unwrap</a>, <a href="shell/wrap.html">wrap</a></p>



<div class="subentry">Experimental operators</div>
<p class="ops"><a href="shell/quota.html">quota</a></p>



<div class="subentry">Non-relational operators</div>
<p class="ops"><a href="shell/autonum.html">autonum</a>, <a href="shell/clip.html">clip</a>, <a href="shell/coerce.html">coerce</a>, <a href="shell/compact.html">compact</a>, <a href="shell/defaults.html">defaults</a>, <a href="shell/generator.html">generator</a>, <a href="shell/sort.html">sort</a></p>



<div class="subentry">Other commands</div>
<p class="ops"><a href="shell/exec.html">exec</a>, <a href="shell/help.html">help</a>, <a href="shell/show.html">show</a></p>



</div>
</div>

<div class="menu-entry" id="menu-ruby">
<div class="head"><a href="javascript:open('ruby');">Alf in Ruby</a></div>
<div class="content" style="display:none;"><div class="subentry">Relational operators</div>
<p class="ops"><a href="ruby/extend.html">extend</a>, <a href="ruby/group.html">group</a>, <a href="ruby/intersect.html">intersect</a>, <a href="ruby/join.html">join</a>, <a href="ruby/matching.html">matching</a>, <a href="ruby/minus.html">minus</a>, <a href="ruby/not-matching.html">not-matching</a>, <a href="ruby/project.html">project</a>, <a href="ruby/rank.html">rank</a>, <a href="ruby/rename.html">rename</a>, <a href="ruby/restrict.html">restrict</a>, <a href="ruby/summarize.html">summarize</a>, <a href="ruby/ungroup.html">ungroup</a>, <a href="ruby/union.html">union</a>, <a href="ruby/unwrap.html">unwrap</a>, <a href="ruby/wrap.html">wrap</a></p>



<div class="subentry">Experimental operators</div>
<p class="ops"><a href="ruby/quota.html">quota</a></p>



<div class="subentry">Non-relational operators</div>
<p class="ops"><a href="ruby/autonum.html">autonum</a>, <a href="ruby/clip.html">clip</a>, <a href="ruby/coerce.html">coerce</a>, <a href="ruby/compact.html">compact</a>, <a href="ruby/defaults.html">defaults</a>, <a href="ruby/generator.html">generator</a>, <a href="ruby/sort.html">sort</a></p>



</div>
</div>

<div class="menu-entry" id="menu-devel">
<div class="head"><a href="javascript:open('devel');">Development</a></div>
<div class="content" style="display:none;"><ul>
<li><a href="devel/index.html">Contribute</a></li>
<li><a href="devel/licence.html">Licence</a></li>
</ul>

</div>
</div>

</div>



<div id="page">
<h2>Relational basics</h2>

<p>This page describes the necessary background on relational theory to understand Alf. Note that it only covers the concepts needed to understand the relational <em>algebra</em>; that is, nothing is said about database schemas, normal forms, transactions, ACID properties, and so on. Refer to standard database literature for those.</p>

<p>The background given below is a rephrasing of what can be found in The Third Manifesto (TTM), by Hugh Darwen and C.J. Date. See <a href="http://www.thethirdmanifesto.com">www.thethirdmanifesto.com</a> or <a href="http://www.amazon.com/Databases-Types-Relational-Model-3rd/dp/0321399420">the TTM book</a>.</p>

<h3>A theory of types</h3>

<p>To understand what relational algebra is about, we need to briefly review a few concepts about types. Forget about object-oriented programming for a moment (if you are a developer) and examine the following definitions:</p>

<ul>
<li>A <em>type</em> is a (finite) <strong>set</strong> of values. A <em>subtype</em> is a subset. Sets are <strong>not ordered</strong> and have <strong>no duplicates</strong>.</li>
<li>A <em>value</em> is an element of a type. We say that the value <em>belongs to</em> the type.</li>
<li>A value is <strong>immutable</strong>, intrinsically <strong>typed</strong> [1], has no localization in time and space, and can be of arbitrary complexity.</li>
<li>A type is always accompanied with an equality operator, say <code>==</code>, that allows checking if two of its elements actually denote the same value. The notion of 'duplicate' precisely relies on this operator in an obvious way.</li>
</ul>

<p>Oh! and,</p>

<ul>
<li>NULL is <strong>not</strong> a value. Precisely, ''treating NULL as a value'' on one side and ''keeping a theory simple enough to be of any practical yet sound use'' on the other side are conflictual requirements. Therefore, here, NULL is not a value. </li>
</ul>

<h4>A few examples</h4>

<p>The simplest scalar types are well known: </p>
<blockquote>
<blockquote>
<ul>
<li>(the set of) Boolean(s), Integer(s), Decimal(s), String(s), ...</li>
</ul>
</blockquote></blockquote>
<p>There are others, of course: </p>
<blockquote>
<blockquote>
<ul>
<li>(the set of) Color(s), Size(s), Weight(s), Range(s), Coordinate(s), ... </li>
</ul>
</blockquote></blockquote>
<p>And even a few that people don't always expect to be types: </p>
<blockquote>
<blockquote>
<ul>
<li>(the set of) List(s), Set(s), Tree(s), Graph(s), ...</li>
</ul>
</blockquote></blockquote>
<p>Roughly, surrounding a set of immutable elements for which an equality operator makes sense <em>is</em> defining a type. Implementing it is another story, of course. </p>

<h3>Tuples and Relations</h3>

<p>Tuples and relations are values as well. In contrast to integers or strings however, tuples and relations are not scalar; they have an internal ''structure''. Apart from that, they are values and they have a type. Let's have a closer look at that.</p>

<h4>Tuple</h4>

<ul>
<li>A <em>tuple</em> is a set of attribute (name, value) pairs. It is such that no two pairs have the same name.</li>
<li>A tuple being a set, it is not particularly ordered.</li>
<li>A tuple being a value, it is immutable.</li>
</ul>

<p>We will denote tuple literals as follows (we assume that a Color type exists):</p>

<pre class="theory"><code class="ruby">#
# The product whose id is 'P3',
#  * is named 'Screw', 
#  * has a color denoted by 'blue', and 
#  * is known to be heavy.
#
Tuple( pid: 'P1', name: 'Nut', color: Color('red'), heavy: true )
</code></pre>

<p><p class="note">Alf uses Ruby Hashes for implementing tuples. The example above is syntaxtically correct in Ruby 1.9.x and returns a Hash when usign Alf. Of course, there are hashes that do not implement valid tuples (those containing nil, for example). Alf assumes that you use them in accordance with this background (in an immutable way, among others); it does <strong>not</strong> systematically enforce this precondition. It's up to you to use Alf the correct way.<p></p>

<p>The type of a tuple is simply defined in terms of its heading. A <em>heading</em> is defined as a set of attribute (name, type name) pairs. For example, the heading of the tuple show above is:</p>

<pre class="theory"><code class="ruby">Heading( pid: String, name: String, color: Color, heavy: Boolean )</code></pre>

<p><p class="note">Alf assumes that types are implemented with Ruby classes. String, Color and Boolean are all valid class names in Ruby, though it's worth noting that the Boolean class does not natively exists. As it is of huge importance for Alf, it defines it in such a way that everything looks fine. The Color class is assumed here to be a user-defined class. Not all user-defined classes implement valid types. Alf assumes that you use them in accordance with this background; it does <strong>not</strong> systematically enforce this precondition. It's up to you to use Alf the correct way.<p></p>

<h4>Relation</h4>

<ul>
<li>A <em>relation</em> is a set of tuples of same heading</li>
<li>A relation being a set, it is not particularly ordered and does not have duplicates.</li>
<li>A relation being a value, it is immutable.</li>
</ul>

<p>We will denote relation literals as follows:</p>

<pre class="theory"><code class="ruby">Relation(
  Tuple( pid: 'P1', name: 'Nut',   color: Color('red'),   heavy: true  ),
  Tuple( pid: 'P2', name: 'Bolt',  color: Color('green'), heavy: false ),
  Tuple( pid: 'P3', name: 'Screw', color: Color('blue'),  heavy: false )
)</code></pre>

<p><p class="note">The example above is syntaxtically correct in Alf and returns a relation data structure. Alf support other ways of obtaining relations than literals. Among others, it recognizes different data sources, like .csv files or SQL tables. In any way, Alf assumes that you use relations in accordance with this background; it does <strong>not</strong> systematically enforce this precondition. It's up to you to use Alf the correct way.<p></p>

<p>The type of a relation is simply defined in terms of its heading. For example, the heading of the relation show above is:</p>

<pre class="theory"><code class="ruby">Heading( pid: String, name: String, color: Color, heavy: Boolean )</code></pre>

<h3>A few consequences</h3>

<p>The following list of bullets are logical consequences of the definitions above. Alf considers them as part of its specification; if it does not respect it, it is either a bug or a limitation... for which patches are welcome!</p>

<ul>
<li>Tuples and relations may contain values of any complexity, providing that the corresponding type is consistent with the theory of types stated above.</li>
<li>In particular, tuples and relations may contain... tuples and relations.</li>
</ul>

<p>The following list of bullets are other logical consequences of the definitions above. Alf considers them as pre-conditions of all relational operators, without necessarily enforcing them:</p>

<ul>
<li>All tuples that forms relations have the same &quot;structure&quot;, that is, the same heading</li>
<li>Tuples and relations never contain NULL</li>
<li>No left-right ordering of attributes applies to tuples and relations</li>
<li>No tuple ordering applies to relations</li>
</ul>

<p>That being said, Alf also provides you with a few non-relational operators to clean &quot;noisy&quot; data upstream of relational operators. Also, Alf tend to be &quot;friendly enough&quot; about ordering and NULL. It does not guarantee any behavior nor does it provide you with ways of specifying such behavior on relational operators. </p>

<h3>Relational algebra</h3>

<p>Relational algebra is to relations what elementary algebra is to numbers and quantities in formulae and equations. Consider the following elementary formula:</p>

<pre class="theory"><code class="ruby">z = 2 * (x + y)</code></pre>

<p>Evaluating this formula with <code>x = 5</code> and <code>y = 3</code> yields a value for <code>z</code>:</p>

<pre class="theory"><code class="ruby">16 = 2 * (5 + 3)</code></pre>

<p>Thanks to known properties of the operators, like associativity or commutativity, formulae can be manipulated. For example, the formula above can be rewritten into the following equivalent form:</p>

<pre class="theory"><code class="ruby">z = (2 * x) +  (2 * y) </code></pre>

<p>Relational algebra is similar, but applies to relations. For example:</p>

<pre class="theory"><code class="ruby">#
#  What are red or heavy parts ?
#
(union 
  (restrict :parts, ->(){ color == Color('red') }),
  (restrict :parts, ->(){ heavy == true         }))
</code></pre>

<p>Can be rephrased/rewritten as</p>

<pre class="theory"><code class="ruby">#
#  What parts are either red or heavy ?
#
(restrict :parts, ->(){ (color == Color('red')) or (heavy == true) })
</code></pre>

<h3>Footnotes</h3>

<p>[1] even if you don't <em>declare</em> that type, it exists. So-called 'duck typing' does not mean 'types do not exists', it means 'we do not enforce them when passing arguments', roughly. </p>

</div>


<div id="links">
<a href="http://github.com/blambeau/alf" target="_blank"><img src="images/github-128.png"/></a> 
<a href="http://twitter.com/blambeau" target="_blank"><img src="images/twitter-128.png"/></a> 
</div>
<div id="social">
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="blambeau">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-16520635-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>

