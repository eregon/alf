<!DOCTYPE html>
<head> 
<meta charset='utf-8'> 
<title>Using Alf in Ruby</title> 
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script>
<![endif]--> 
<!--
<base href="file:///home/blambeau/work/devel/alf/doc/deploy-gh-pages/index.html" />
-->
<base href="http://blambeau.github.com/alf/index.html" />
<!--
<link rel='stylesheet' href='http://fonts.googleapis.com/css?family=Gloria+Hallelujah|Nunito:300' type='text/css'> 
-->
<link rel="stylesheet" href="http://yandex.st/highlightjs/6.0/styles/github.min.css" type='text/css'>
<link href="css/style.css" rel='stylesheet'>
<script type="text/javascript" src="js/jquery-1.6.2.min.js"></script>
<script type="text/javascript" src="http://yandex.st/highlightjs/6.0/highlight.min.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    hljs.initHighlightingOnLoad();
  });
</script>
</head>
<body>
<a href="http://github.com/blambeau/alf"><img style="position: fixed; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
<script type="text/javascript">
  var current = "ruby";
  function open(entry) {
    hide(current);
    current = entry;
    show(current);
  };
  function show(entry) {
    $('#menu-' + entry + " .content").slideDown(function(){
      window.location = entry + "/index.html";
    });
  };
  function hide(entry) {
    $('#menu-' + entry + " .content").slideUp();
  };
</script>

<div id="menu">

<div class="menu-entry" id="menu-overview">
<div class="head"><a href="javascript:open('overview');">Overview</a></div>
<div class="content" style="display:none;"><ul>
<li><a href="overview/index.html">Home</a></li>
<li><a href="overview/why.html">Why Alf ?</a></li>
<li><a href="overview/guided-tour.html">Guided tour</a></li>
<li><a href="overview/relational-basics.html">Relational basics</a></li>
<li><a href="overview/one-proposal-three-flavors.html">One proposal, three flavors</a></li>
<li><a href="overview/further-reading.html">Further reading</a></li>
</ul>

</div>
</div>

<div class="menu-entry" id="menu-shell">
<div class="head"><a href="javascript:open('shell');">Alf in Shell</a></div>
<div class="content" style="display:none;"><div class="subentry">Relational operators</div>
<p class="ops"><a href="shell/extend.html">extend</a>, <a href="shell/group.html">group</a>, <a href="shell/intersect.html">intersect</a>, <a href="shell/join.html">join</a>, <a href="shell/matching.html">matching</a>, <a href="shell/minus.html">minus</a>, <a href="shell/not-matching.html">not-matching</a>, <a href="shell/project.html">project</a>, <a href="shell/rank.html">rank</a>, <a href="shell/rename.html">rename</a>, <a href="shell/restrict.html">restrict</a>, <a href="shell/summarize.html">summarize</a>, <a href="shell/ungroup.html">ungroup</a>, <a href="shell/union.html">union</a>, <a href="shell/unwrap.html">unwrap</a>, <a href="shell/wrap.html">wrap</a></p>



<div class="subentry">Experimental operators</div>
<p class="ops"><a href="shell/quota.html">quota</a></p>



<div class="subentry">Non-relational operators</div>
<p class="ops"><a href="shell/autonum.html">autonum</a>, <a href="shell/clip.html">clip</a>, <a href="shell/coerce.html">coerce</a>, <a href="shell/compact.html">compact</a>, <a href="shell/defaults.html">defaults</a>, <a href="shell/generator.html">generator</a>, <a href="shell/sort.html">sort</a></p>



<div class="subentry">Other commands</div>
<p class="ops"><a href="shell/exec.html">exec</a>, <a href="shell/help.html">help</a>, <a href="shell/show.html">show</a></p>



</div>
</div>

<div class="menu-entry" id="menu-ruby">
<div class="head"><a href="javascript:open('ruby');">Alf in Ruby</a></div>
<div class="content" ><div class="subentry">Relational operators</div>
<p class="ops"><a href="ruby/extend.html">extend</a>, <a href="ruby/group.html">group</a>, <a href="ruby/intersect.html">intersect</a>, <a href="ruby/join.html">join</a>, <a href="ruby/matching.html">matching</a>, <a href="ruby/minus.html">minus</a>, <a href="ruby/not-matching.html">not-matching</a>, <a href="ruby/project.html">project</a>, <a href="ruby/rank.html">rank</a>, <a href="ruby/rename.html">rename</a>, <a href="ruby/restrict.html">restrict</a>, <a href="ruby/summarize.html">summarize</a>, <a href="ruby/ungroup.html">ungroup</a>, <a href="ruby/union.html">union</a>, <a href="ruby/unwrap.html">unwrap</a>, <a href="ruby/wrap.html">wrap</a></p>



<div class="subentry">Experimental operators</div>
<p class="ops"><a href="ruby/quota.html">quota</a></p>



<div class="subentry">Non-relational operators</div>
<p class="ops"><a href="ruby/autonum.html">autonum</a>, <a href="ruby/clip.html">clip</a>, <a href="ruby/coerce.html">coerce</a>, <a href="ruby/compact.html">compact</a>, <a href="ruby/defaults.html">defaults</a>, <a href="ruby/generator.html">generator</a>, <a href="ruby/sort.html">sort</a></p>



</div>
</div>

<div class="menu-entry" id="menu-devel">
<div class="head"><a href="javascript:open('devel');">Development</a></div>
<div class="content" style="display:none;"><ul>
<li><a href="devel/index.html">Contribute</a></li>
<li><a href="devel/licence.html">Licence</a></li>
</ul>

</div>
</div>

</div>



<div id="page">
<h2>Using Alf in Ruby</h2>

<p>Alf implements a Domain Specific Language (DSL), for writing and executing relational queries. This DSL aims at being powerful yet simple and intuitive to use.</p>

<pre class="theory"><code class="ruby">#                                                 
# What is the total weight of supplied products,     
# by city, then by product id?                    
#                                                 
(group                                            +--------+---------------------+
  (summarize (join :parts, :supplies),            | :city  | :supplying          |
    [:city, :pid],                                +--------+---------------------+
    :total => sum{ weight * qty }),               | London | +------+---------+  |
  [:pid, :total], :supplying)                     |        | | :pid | :total  |  |
                                                  |        | +------+---------+  |
                                                  |        | | P1   | 7200.00 |  |
                                                  |        | | P4   | 7000.00 |  |
                                                  |        | | P6   | 1900.00 |  |
                                                  | ...    | | ...  | ...     |  |
</code></pre>

<h3>Evaluation of DSL expressions</h3>

<ul>
<li>Ala &quot;ruby -e&quot;, for shortest expressions (see also <a href="shell/index">Using Alf in Shell</a>)</li>
</ul>

<pre><code class="terminal">$ alf -e "(restrict :suppliers, ->(){ city == 'London' })"</code></pre>

<ul>
<li>Through .alf files that contain them</li>
</ul>

<pre><code class="terminal">$ alf path/to/my/query.alf</code></pre>

<ul>
<li>In Ruby scripts and programs</li>
</ul>

<pre><code class="ruby">require 'alf'
Alf.lispy.evaluate{
  (restrict :suppliers, ->(){ city == 'London' })
}
</code></pre>

<h3>A few stuff you want to know</h3>

<ul>
<li>Alf is not limited to the use of simple scalar types. Attribute can be any ruby class/object implementing a type/value in a consistent way. You also have full Ruby power in expressions:</li>
</ul>

<pre><code class="ruby">Alf.lispy.evaluate{
  (restrict :suppliers, ->(){ city =~ /^P/ })
}</code></pre>

<ul>
<li>Alf automatically resolves relation names according to an environment of use. By default, the latter is bound to the examples bundled with Alf. This way, you can learn Alf without worrying about where data come from, or even get it as plain ruby objects:</li>
</ul>

<pre><code class="ruby">rel = Alf.lispy.evaluate{
  (join :suppliers, :cities)
}
puts rel.to_a
</code></pre>

<ul>
<li>Of course, you can connect Alf to other datasources (see API doc)</li>
</ul>

<pre><code class="ruby">Alf.lispy("postgres://tom@localhost/myerp").evaluate{
  (summarize (join :bills, :clients), [:client_id], :total => sum{ qty*price })
}
</code></pre>

<ul>
<li>Alf is shipped with a true <code>Relation</code> data structure, that is, a set of tuples. Those relations can be used as relation literals in DSL expressions.</li>
</ul>

<pre><code class="ruby">cities = Alf::Relation[
  {:city => "London"},
  {:city => "Paris"},
  {:city => "Oslo"}
]
</code></pre>

<ul>
<li>While not idomatic and not recommended, you can also use Alf with an object-oriented style thanks to <code>Relation</code>:</li>
</ul>

<pre><code class="ruby">cities.extend(:bigname => ->(){ city.upcase })</code></pre>


</div>



<div id="links">
<a href="http://github.com/blambeau/alf" target="_blank"><img src="images/github-128.png"/></a> 
<a href="http://twitter.com/blambeau" target="_blank"><img src="images/twitter-128.png"/></a> 
</div>
<div id="social">
<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="blambeau">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
</div>
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-16520635-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>

